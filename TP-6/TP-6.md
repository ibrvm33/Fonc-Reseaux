# TP6 : Un LAN maîtrisé meo ?

## I. Setup routeur

## II. Serveur DNS

### 1. Présentation

### 2. Setup

🌞 Dans le rendu, je veux

     sudo cat /etc/named.conf
    //
    // named.conf
    //
    // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
    // server as a caching only nameserver (as a localhost DNS resolver only).
    //
    // See /usr/share/doc/bind*/sample/ for example named configuration files.
    //

    options {
        listen-on port 53 { 127.0.0.1; any; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     { localhost; any; };
        allow-query-cache { localhost; any; };

        recursion yes;

        dnssec-validation yes;

        managed-keys-directory "/var/named/dynamic";
        geoip-directory "/usr/share/GeoIP";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
    };

    logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
    };

    zone "tp6.b1" IN {
        type master;
        file "tp6.b1.db";
        allow-update { none; };
        allow-query {any; };
    };

    zone "1.4.10.in-addr.arpa" IN {
     type master;
     file "tp6.b1.rev";
     allow-update { none; };
     allow-query { any; };
    };

    include "/etc/named.rfc1912.zones";
    include "/etc/named.root.key";
#
     sudo cat /var/named/tp6.b1.db
    $TTL 86400
    @ IN SOA dns.tp6.b1. admin.tp6.b1. (
    2019061800 ;Serial
    3600 ;Refresh
    1800 ;Retry
    604800 ;Expire
    86400 ;Minimum TTL
    )

    ; Infos sur le serveur DNS lui même (NS = NameServer)
    @ IN NS dns.tp6.b1.

    ; Enregistrements DNS pour faire correspondre des noms à des IPs
    dns       IN A 10.6.1.101
    john      IN A 10.6.1.11
#
     sudo cat /var/named/tp6.b1.rev
    $TTL 86400
    @ IN SOA dns.tp6.b1. admin.tp6.b1. (
    2019061800 ;Serial
    3600 ;Refresh
    1800 ;Retry
    604800 ;Expire
    86400 ;Minimum TTL
    )

    ; Infos sur le serveur DNS lui même (NS = NameServer)
    @ IN NS dns.tp6.b1.

    ; Reverse lookup
    101 IN PTR dns.tp6.b1.
    11 IN PTR john.tp6.b1.
#
     systemctl status named
    ● named.service - Berkeley Internet Name Domain (DNS)
     Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; preset: disabled)
     Active: active (running) since Tue 2023-11-21 10:54:45 CET; 5min ago
    Main PID: 5049 (named)
      Tasks: 5 (limit: 4610)
     Memory: 18.8M
        CPU: 35ms
     CGroup: /system.slice/named.service
             └─5049 /usr/sbin/named -u named -c /etc/named.conf
#
     ss -antp
    State        Recv-Q       Send-Q             Local Address:Port             Peer Address:Port       Process
    LISTEN       0            4096                   127.0.0.1:953                   0.0.0.0:*
    LISTEN       0            10                     127.0.0.1:53                    0.0.0.0:*
    LISTEN       0            10                    10.6.1.101:53                    0.0.0.0:*
    LISTEN       0            128                      0.0.0.0:22                    0.0.0.0:*
    ESTAB        0            52                    10.6.1.101:22                   10.6.1.1:64470
    LISTEN       0            4096                       [::1]:953                      [::]:*
    LISTEN       0            10                         [::1]:53                       [::]:*
    LISTEN       0            128                         [::]:22                       [::]:*

🌞 Ouvrez le bon port dans le firewall

     sudo firewall-cmd --add-port=53/udp --permanent
    success
     sudo firewall-cmd --reload
    success

### 3. Test

🌞 Sur la machine john.tp6.b1

     sudo cat /etc/resolv.conf
    # Generated by NetworkManager
    search tp6.b1
    nameserver 10.6.1.101

     ping john.tp6.b1
    PING john.tp6.b1 (10.6.1.11) 56(84) bytes of data.
    64 bytes from john.tp6.b1 (10.6.1.11): icmp_seq=1 ttl=64 time=0.063 ms
    64 bytes from john.tp6.b1 (10.6.1.11): icmp_seq=2 ttl=64 time=0.073 ms
    64 bytes from john.tp6.b1 (10.6.1.11): icmp_seq=3 ttl=64 time=0.069 ms
    ^C
    --- john.tp6.b1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2006ms
    rtt min/avg/max/mdev = 0.063/0.068/0.073/0.004 ms
     ping dns.tp6.b1
    PING dns.tp6.b1 (10.6.1.101) 56(84) bytes of data.
    64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=1 ttl=64 time=0.672 ms
    64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=2 ttl=64 time=0.586 ms
    64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=3 ttl=64 time=1.16 ms
    ^C
    --- dns.tp6.b1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2005ms
    rtt min/avg/max/mdev = 0.586/0.805/1.159/0.252 ms
     ping www.ynov.com
    PING www.ynov.com (104.26.11.233) 56(84) bytes of data.
    64 bytes from 104.26.11.233 (104.26.11.233): icmp_seq=1 ttl=55 time=20.9 ms
    64 bytes from 104.26.11.233 (104.26.11.233): icmp_seq=2 ttl=55 time=18.5 ms
    64 bytes from 104.26.11.233 (104.26.11.233): icmp_seq=3 ttl=55 time=19.1 ms
    ^C
    --- www.ynov.com ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2420ms
    rtt min/avg/max/mdev = 18.453/19.484/20.871/1.018 ms

🌞 Sur votre PC

    PS C:\Windows\system32> ping john

    Envoi d’une requête 'ping' sur john [10.6.1.11] avec 32 octets de données :
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64

    Statistiques Ping pour 10.6.1.11:
    Paquets : envoyés = 4, reçus = 4, perdus = 0 (perte 0%),
    Durée approximative des boucles en millisecondes :
    Minimum = 0ms, Maximum = 0ms, Moyenne = 0ms
    PS C:\Windows\system32> ping john.tp6.b1

    Envoi d’une requête 'ping' sur john [10.6.1.11] avec 32 octets de données :
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64
    Réponse de 10.6.1.11 : octets=32 temps<1ms TTL=64

    Statistiques Ping pour 10.6.1.11:
    Paquets : envoyés = 4, reçus = 4, perdus = 0 (perte 0%),
    Durée approximative des boucles en millisecondes :
    Minimum = 0ms, Maximum = 0ms, Moyenne = 0ms
#
    🦈 Capture tp6_dns.pcapng

## III. Serveur DHCP

🌞 Installer un serveur DHCP

🌞 Test avec john.tp6.b1

🌞 Requête web avec john.tp6.b1

    🦈 Capture tp6_web.pcapng

## IV. Bonus : Serveur Web HTTPS 

    o